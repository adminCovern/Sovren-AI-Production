"use strict";(()=>{var a={};a.id=1360,a.ids=[1360],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:a=>{a.exports=require("bcrypt")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{a.exports=require("path")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63602:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>H,patchFetch:()=>G,routeModule:()=>C,serverHooks:()=>F,workAsyncStorage:()=>D,workUnitAsyncStorage:()=>E});var d={};c.r(d),c.d(d,{GET:()=>B,POST:()=>z});var e=c(96559),f=c(48088),g=c(37719),h=c(26191),i=c(81289),j=c(261),k=c(92603),l=c(39893),m=c(14823),n=c(47220),o=c(66946),p=c(47912),q=c(99786),r=c(46143),s=c(86439),t=c(43365),u=c(89915),v=c(97297),w=c(8825),x=c(50378);async function y(a){try{w.kL.resolve(w.Vd.ERROR_HANDLER)}catch(a){(0,x.AH)()}let b=w.kL.resolve(w.Vd.ERROR_HANDLER),c=w.kL.resolve(w.Vd.TTS_BACKEND_SERVICE),d=await a.json(),e=Date.now();if(!d.text||0===d.text.trim().length)throw b.createError("EMPTY_TEXT","Text content cannot be empty",v.h.VALIDATION,v.MU.MEDIUM,{},{userMessage:"Please provide text to synthesize.",suggestedActions:["Enter text content for synthesis"]});if(d.text.length>5e3)throw b.createError("TEXT_TOO_LONG",`Text length ${d.text.length} exceeds maximum of 5000 characters`,v.h.VALIDATION,v.MU.MEDIUM,{additionalData:{textLength:d.text.length,maxLength:5e3}},{userMessage:`Text is too long (${d.text.length} characters). Maximum allowed is 5000 characters.`,suggestedActions:["Shorten the text","Split into multiple requests"]});if(!d.voiceId||0===d.voiceId.trim().length)throw b.createError("MISSING_VOICE_ID","Voice ID is required for synthesis",v.h.VALIDATION,v.MU.MEDIUM,{},{userMessage:"Please select a voice for synthesis.",suggestedActions:["Choose from available voices"]});let f=["wav","mp3","ogg"];if(d.format&&!f.includes(d.format))throw b.createError("INVALID_FORMAT",`Invalid audio format: ${d.format}. Supported formats: ${f.join(", ")}`,v.h.VALIDATION,v.MU.MEDIUM,{additionalData:{providedFormat:d.format,validFormats:f}},{userMessage:`Invalid audio format. Supported formats: ${f.join(", ")}`,suggestedActions:["Use wav, mp3, or ogg format"]});let g=[16e3,22050,44100,48e3];if(d.sampleRate&&!g.includes(d.sampleRate))throw b.createError("INVALID_SAMPLE_RATE",`Invalid sample rate: ${d.sampleRate}. Supported rates: ${g.join(", ")}`,v.h.VALIDATION,v.MU.MEDIUM,{additionalData:{providedRate:d.sampleRate,validRates:g}},{userMessage:`Invalid sample rate. Supported rates: ${g.join(", ")} Hz`,suggestedActions:["Use a supported sample rate"]});let h=await b.handleAsync(()=>c.synthesize({text:d.text,voiceId:d.voiceId,priority:d.priority||"medium",format:d.format||"wav",sampleRate:d.sampleRate||22050,userId:d.userId}),{additionalData:{textLength:d.text.length,voiceId:d.voiceId,format:d.format||"wav"}},{retries:2,retryDelay:2e3,fallback:async()=>{throw b.createError("TTS_SERVICE_UNAVAILABLE","Text-to-speech service is temporarily unavailable",v.h.EXTERNAL_SERVICE,v.MU.HIGH,{},{userMessage:"Voice synthesis service is temporarily unavailable. Please try again later.",suggestedActions:["Wait a few minutes and try again","Contact support if problem persists"]})}}),i=Date.now()-e;return{success:!0,audioData:h.audioData,audioUrl:h.audioUrl,duration:h.duration,processingTime:i,voiceId:d.voiceId,metadata:{sampleRate:h.sampleRate,format:h.format,size:h.size,quality:h.quality}}}let z=(0,u.Uj)(y,{endpoint:"/api/tts/synthesize",requireAuth:!0,rateLimit:{windowMs:6e4,max:10},validation:function(a){let b=[];return a&&"object"==typeof a?(a.text?"string"!=typeof a.text?b.push("Text must be a string"):0===a.text.trim().length?b.push("Text cannot be empty"):a.text.length>5e3&&b.push("Text cannot exceed 5000 characters"):b.push("Text is required"),a.voiceId?"string"!=typeof a.voiceId&&b.push("Voice ID must be a string"):b.push("Voice ID is required"),a.priority&&!["low","medium","high"].includes(a.priority)&&b.push("Priority must be low, medium, or high"),a.format&&!["wav","mp3","ogg"].includes(a.format)&&b.push("Format must be wav, mp3, or ogg"),a.sampleRate&&![16e3,22050,44100,48e3].includes(a.sampleRate)&&b.push("Sample rate must be 16000, 22050, 44100, or 48000"),{valid:0===b.length,errors:b.length>0?b:void 0}):(b.push("Request body must be a valid JSON object"),{valid:!1,errors:b})}});async function A(a){try{w.kL.resolve(w.Vd.ERROR_HANDLER)}catch(a){(0,x.AH)()}let b=w.kL.resolve(w.Vd.ERROR_HANDLER),c=w.kL.resolve(w.Vd.TTS_BACKEND_SERVICE),d=await b.handleAsync(()=>c.healthCheck(),{},{retries:1,retryDelay:1e3,fallback:async()=>!1}),e=(await b.handleAsync(()=>c.getAvailableVoices(),{},{retries:1,retryDelay:1e3,fallback:async()=>[]})).map(a=>a.id);return{status:d?"healthy":"unhealthy",service:"TTS Backend Service",timestamp:new Date().toISOString(),availableVoices:e,isHealthy:d}}let B=(0,u.Uj)(A,{endpoint:"/api/tts/synthesize",requireAuth:!1}),C=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/tts/synthesize/route",pathname:"/api/tts/synthesize",filename:"route",bundlePath:"app/api/tts/synthesize/route"},distDir:".next",projectDir:"",resolvedPagePath:"C:\\Users\\brian\\OneDrive - Covren Firm\\Desktop\\Sovren-AI-Production\\src\\app\\api\\tts\\synthesize\\route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:D,workUnitAsyncStorage:E,serverHooks:F}=C;function G(){return(0,g.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:E})}async function H(a,b,c){var d;let e="/api/tts/synthesize/route";"/index"===e&&(e="/");let g=await C.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[E]||y.routes[D]);if(F&&!x){let a=!!y.routes[D],b=y.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||C.isDev||x||(G="/index"===(G=D)?"/":G);let H=!0===C.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>C.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>C.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await C.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await C.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await C.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},77598:a=>{a.exports=require("node:crypto")},79428:a=>{a.exports=require("buffer")},79646:a=>{a.exports=require("child_process")},84835:a=>{a.exports=require("redis")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},89915:(a,b,c)=>{c.d(b,{Uj:()=>j});var d=c(32190),e=c(97297),f=c(8825),g=c(50378);class h{constructor(){this.errorHandler=null,this.logger=null}getErrorHandler(){if(!this.errorHandler)try{this.errorHandler=f.kL.resolve(f.Vd.ERROR_HANDLER)}catch(a){(0,g.AH)(),this.errorHandler=f.kL.resolve(f.Vd.ERROR_HANDLER)}return this.errorHandler}getLogger(){if(!this.logger)try{this.logger=f.kL.resolve(f.Vd.LOGGER)}catch(a){(0,g.AH)(),this.logger=f.kL.resolve(f.Vd.LOGGER)}return this.logger}wrapHandler(a,b){return async c=>{let f=Date.now(),g=this.generateRequestId(),h=b.endpoint,i=c.method,j=c.headers.get("user-agent")||"unknown",k=this.getClientIP(c);try{if(this.getLogger().info(`ðŸ“¥ API Request: ${i} ${h}`,{requestId:g,userAgent:j,ipAddress:k}),b.requireAuth&&await this.validateAuthentication(c),b.rateLimit&&await this.checkRateLimit(c,b.rateLimit),b.validation&&("POST"===i||"PUT"===i||"PATCH"===i)){let a=await c.json(),d=b.validation(a);if(!d.valid)throw this.getErrorHandler().createError("VALIDATION_FAILED",`Input validation failed: ${d.errors?.join(", ")}`,e.h.VALIDATION,e.MU.MEDIUM,{requestId:g,endpoint:h,method:i,ipAddress:k,userAgent:j},{userMessage:"Please check your input and try again.",suggestedActions:d.errors||["Verify input format"]})}let l=await a(c),m=Date.now()-f;this.getLogger().info(`âœ… API Success: ${i} ${h}`,{requestId:g,processingTime:m,status:"success"});let n={success:!0,data:l,requestId:g,metadata:{endpoint:h,method:i,processingTime:m,timestamp:new Date().toISOString()}};return d.NextResponse.json(n)}catch(a){return this.handleError(a,{requestId:g,endpoint:h,method:i,userAgent:j,ipAddress:k,processingTime:Date.now()-f})}}}handleError(a,b){let c;c=this.isSOVRENError(a)?a:this.getErrorHandler().handleError(a instanceof Error?a:Error(String(a)),{requestId:b.requestId,endpoint:b.endpoint,method:b.method,userAgent:b.userAgent,ipAddress:b.ipAddress,additionalData:{processingTime:b.processingTime}}),this.getLogger().error(`âŒ API Error: ${b.method} ${b.endpoint}`,{errorId:c.id,requestId:b.requestId,category:c.category,severity:c.severity,message:c.internalMessage,processingTime:b.processingTime});let e=this.getHTTPStatusCode(c),f={success:!1,error:{code:c.code,message:c.internalMessage,category:c.category,severity:c.severity,userMessage:c.userMessage,suggestedActions:c.suggestedActions,isRetryable:c.isRetryable,errorId:c.id,timestamp:c.context.timestamp.toISOString()},requestId:b.requestId,metadata:{endpoint:b.endpoint,method:b.method,processingTime:b.processingTime,userAgent:b.userAgent,ipAddress:b.ipAddress}};return d.NextResponse.json(f,{status:e})}async validateAuthentication(a){let b=a.headers.get("authorization"),c=a.cookies.get("auth-token")?.value;if(!b&&!c)throw this.getErrorHandler().createError("MISSING_AUTHENTICATION","No authentication token provided",e.h.AUTHENTICATION,e.MU.HIGH,{},{userMessage:"Please log in to access this resource.",suggestedActions:["Log in with valid credentials"]})}async checkRateLimit(a,b){this.getClientIP(a)}generateRequestId(){return`req_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}getClientIP(a){let b=a.headers.get("x-forwarded-for"),c=a.headers.get("x-real-ip"),d=a.headers.get("cf-connecting-ip");return b?.split(",")[0]||c||d||"unknown"}getHTTPStatusCode(a){switch(a.category){case e.h.AUTHENTICATION:return 401;case e.h.AUTHORIZATION:return 403;case e.h.VALIDATION:return 400;case e.h.RATE_LIMIT:return 429;case e.h.NETWORK:return 502;case e.h.EXTERNAL_SERVICE:return 503;case e.h.SECURITY:return 400;case e.h.BUSINESS_LOGIC:return 422;case e.h.CONFIGURATION:case e.h.DATABASE:case e.h.SYSTEM:default:return 500}}isSOVRENError(a){return!!(a&&"object"==typeof a&&null!==a&&"id"in a&&"code"in a&&"message"in a&&"category"in a&&"severity"in a&&"context"in a&&"isRetryable"in a&&"userMessage"in a&&"internalMessage"in a&&"suggestedActions"in a)}}let i=new h;function j(a,b){return i.wrapHandler(a,b)}},94735:a=>{a.exports=require("events")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[4985,382,3205,5856,86,3326,378],()=>b(b.s=63602));module.exports=c})();