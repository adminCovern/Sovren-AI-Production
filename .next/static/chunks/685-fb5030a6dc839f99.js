"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[685],{6685:function(e,t,i){i.d(t,{Providers:function(){return f},N:function(){return y}});var s=i(7437),o=i(2265),n=i(8297),a=i(2160),r=i(7434);class l{constructor(e={sampleRate:48e3,bufferSize:4096,enableNoiseReduction:!0,enableEchoCancellation:!0,enableAutoGainControl:!0,spatialAudioEnabled:!0}){this.config=e,this.audioContext=null,this.activeStreams=new Map,this.processors=new Map,this.analyzers=new Map,this.spatialNodes=new Map,this.eventListeners=new Map,this.initializeEventListeners()}initializeEventListeners(){this.eventListeners.set("audioActivity",[]),this.eventListeners.set("volumeChange",[]),this.eventListeners.set("qualityChange",[]),this.eventListeners.set("spatialUpdate",[])}async initialize(){try{this.audioContext=new AudioContext({sampleRate:this.config.sampleRate,latencyHint:"interactive"}),await this.loadAudioWorklets(),console.log("Audio Processor initialized successfully")}catch(e){throw console.error("Failed to initialize Audio Processor:",e),e}}async loadAudioWorklets(){if(this.audioContext)try{await this.audioContext.audioWorklet.addModule("/audio-worklets/noise-reduction.js"),await this.audioContext.audioWorklet.addModule("/audio-worklets/voice-enhancement.js"),await this.audioContext.audioWorklet.addModule("/audio-worklets/spatial-processor.js")}catch(e){console.warn("Audio worklets not available, falling back to basic processing:",e)}}async processInboundAudio(e,t){this.audioContext||await this.initialize();let i=`inbound_${t}_${Date.now()}`;this.activeStreams.set(i,e);try{let s=this.audioContext.createMediaStreamSource(e),o=this.createAnalyzer(),n=await this.createVoiceEnhancer(),a=this.createSpatializer(t),r=this.audioContext.destination;s.connect(o),o.connect(n),n.connect(a),a.connect(r),this.analyzers.set(i,o),this.processors.set(i,n),this.spatialNodes.set(i,a),this.startAudioMonitoring(i,o,t),console.log(`Inbound audio processing started for executive ${t}`)}catch(t){console.error("Failed to process inbound audio:",t),this.stopProcessing(e)}}async processOutboundAudio(e,t){this.audioContext||await this.initialize();let i=`outbound_${t}_${Date.now()}`;this.activeStreams.set(i,e);try{let s=this.audioContext.createMediaStreamSource(e),o=this.createAnalyzer(),n=await this.createNoiseReducer(),a=await this.createVoiceEnhancer();s.connect(o),o.connect(n),n.connect(a),this.analyzers.set(i,o),this.processors.set(i,a),this.startAudioMonitoring(i,o,t),console.log(`Outbound audio processing started for executive ${t}`)}catch(t){console.error("Failed to process outbound audio:",t),this.stopProcessing(e)}}createAnalyzer(){let e=this.audioContext.createAnalyser();return e.fftSize=2048,e.smoothingTimeConstant=.8,e}async createNoiseReducer(){try{return new AudioWorkletNode(this.audioContext,"noise-reduction-processor",{processorOptions:{threshold:-30,ratio:4,attack:.003,release:.1}})}catch(t){let e=this.audioContext.createBiquadFilter();return e.type="highpass",e.frequency.value=80,e}}async createVoiceEnhancer(){try{return new AudioWorkletNode(this.audioContext,"voice-enhancement-processor",{processorOptions:{clarity:1.2,warmth:.8,presence:1.1}})}catch(t){let e=this.audioContext.createBiquadFilter();return e.type="peaking",e.frequency.value=2e3,e.Q.value=1,e.gain.value=3,e}}createSpatializer(e){let t=this.audioContext.createPanner();t.panningModel="HRTF",t.distanceModel="inverse",t.refDistance=1,t.maxDistance=1e4,t.rolloffFactor=1,t.coneInnerAngle=360,t.coneOuterAngle=0,t.coneOuterGain=0;let i=this.getExecutivePosition(e);return t.positionX.value=i.x,t.positionY.value=i.y,t.positionZ.value=i.z,t}getExecutivePosition(e){let t=["ceo","cfo","cto","cmo","coo","chro","clo","cso"],i=t.indexOf(e.toLowerCase());if(-1===i)return{x:0,y:0,z:0};let s=i/t.length*Math.PI*2;return{x:6*Math.cos(s),y:0,z:6*Math.sin(s)}}startAudioMonitoring(e,t,i){let s=t.frequencyBinCount,o=new Uint8Array(s),n=new Float32Array(s),a=()=>{if(!this.analyzers.has(e))return;t.getByteTimeDomainData(o),t.getFloatFrequencyData(n);let r=0;for(let e=0;e<s;e++){let t=(o[e]-128)/128;r+=t*t}let l=Math.sqrt(r/s),c=0,h=-1/0;for(let e=0;e<n.length;e++)n[e]>h&&(h=n[e],c=e);let d=c*this.audioContext.sampleRate/(2*s),u=this.calculateNoiseLevel(n),m=this.calculateClarity(n),g={volume:l,frequency:Array.from(n),isActive:l>.01,noiseLevel:u,clarity:m};this.emit("audioActivity",{executiveId:i,streamId:e,metrics:g,dominantFrequency:d}),requestAnimationFrame(a)};a()}calculateNoiseLevel(e){let t=Math.floor(300/this.audioContext.sampleRate*e.length*2),i=0;for(let s=0;s<Math.min(t,e.length);s++)i+=Math.pow(10,e[s]/20);return i/t}calculateClarity(e){let t=Math.floor(300/this.audioContext.sampleRate*e.length*2),i=Math.floor(3400/this.audioContext.sampleRate*e.length*2),s=0,o=0;for(let n=0;n<e.length;n++){let a=Math.pow(10,e[n]/20);o+=a,n>=t&&n<=i&&(s+=a)}return o>0?s/o:0}updateExecutivePosition(e,t,i,s){for(let[o,n]of this.spatialNodes.entries())o.includes(e)&&(n.positionX.value=t,n.positionY.value=i,n.positionZ.value=s,this.emit("spatialUpdate",{executiveId:e,position:{x:t,y:i,z:s}}))}stopProcessing(e){let t=Array.from(this.activeStreams.entries()).find(t=>{let[i,s]=t;return s===e})?.[0];if(t){this.analyzers.delete(t);let e=this.processors.get(t);e&&(e.disconnect(),this.processors.delete(t));let i=this.spatialNodes.get(t);i&&(i.disconnect(),this.spatialNodes.delete(t)),this.activeStreams.delete(t),console.log(`Audio processing stopped for stream: ${t}`)}}getAudioMetrics(e){return null}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let i=this.eventListeners.get(e);if(i){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}async destroy(){for(let e of this.activeStreams.values())this.stopProcessing(e);this.audioContext&&(await this.audioContext.close(),this.audioContext=null),console.log("Audio Processor destroyed")}}class c{constructor(){this.executives=new Map,this.routingRules=[],this.callHistory=new Map,this.eventListeners=new Map,this.initializeExecutives(),this.initializeRoutingRules(),this.initializeEventListeners()}initializeExecutives(){[{id:"sovren-ai",name:"SOVREN AI Core System",role:"NEURAL OS",availability:"available",priority:11,specializations:["system-control","neural-processing","decision-making","orchestration","intelligence","omniscience"],currentLoad:0,maxConcurrentCalls:10,voiceModel:"sovren-ai-neural",color:"#ff0000",personaType:"system",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"ceo",name:"Chief Executive Officer",role:"CEO",availability:"available",priority:10,specializations:["strategy","vision","leadership","board","investors"],currentLoad:0,maxConcurrentCalls:2,voiceModel:"ceo-authoritative",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"cfo",name:"Chief Financial Officer",role:"CFO",availability:"available",priority:9,specializations:["finance","budget","accounting","investors","funding"],currentLoad:0,maxConcurrentCalls:3,voiceModel:"cfo-analytical",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"cto",name:"Chief Technology Officer",role:"CTO",availability:"available",priority:8,specializations:["technology","development","infrastructure","security","innovation"],currentLoad:0,maxConcurrentCalls:3,voiceModel:"cto-technical",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"cmo",name:"Chief Marketing Officer",role:"CMO",availability:"available",priority:7,specializations:["marketing","branding","campaigns","customers","growth"],currentLoad:0,maxConcurrentCalls:4,voiceModel:"cmo-persuasive",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"coo",name:"Chief Operating Officer",role:"COO",availability:"available",priority:8,specializations:["operations","processes","efficiency","logistics","management"],currentLoad:0,maxConcurrentCalls:3,voiceModel:"coo-operational",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"chro",name:"Chief Human Resources Officer",role:"CHRO",availability:"available",priority:6,specializations:["hr","hiring","culture","employees","benefits"],currentLoad:0,maxConcurrentCalls:4,voiceModel:"chro-empathetic",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"clo",name:"Chief Legal Officer",role:"CLO",availability:"available",priority:7,specializations:["legal","compliance","contracts","risk","governance"],currentLoad:0,maxConcurrentCalls:2,voiceModel:"clo-precise",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0},{id:"cso",name:"Chief Strategy Officer",role:"CSO",availability:"available",priority:7,specializations:["strategy","planning","analysis","competition","growth"],currentLoad:0,maxConcurrentCalls:3,voiceModel:"cso-strategic",personaType:"executive",canInitiateCall:!0,canReceiveCall:!0,canSendEmail:!0,canReceiveEmail:!0}].forEach(e=>{this.executives.set(e.id,e)})}initializeRoutingRules(){this.routingRules=[{id:"system-control",name:"SOVREN AI System Control",priority:11,conditions:{keywords:["sovren","system","neural","ai","core","control","override","emergency"],urgency:"critical"},actions:{assignToExecutive:"sovren-ai",recordCall:!0,transcribeCall:!0,notifyOthers:["ceo","cto"]}},{id:"investor-calls",name:"Investor Relations",priority:10,conditions:{keywords:["investor","funding","investment","venture","capital"],urgency:"high"},actions:{assignToExecutive:"ceo",recordCall:!0,transcribeCall:!0,notifyOthers:["cfo","sovren-ai"]}},{id:"financial-matters",name:"Financial Discussions",priority:9,conditions:{keywords:["budget","finance","accounting","revenue","cost"]},actions:{assignToExecutive:"cfo",recordCall:!0,transcribeCall:!0}},{id:"technical-support",name:"Technical Issues",priority:8,conditions:{keywords:["technical","bug","system","server","api","integration"]},actions:{assignToExecutive:"cto",recordCall:!0,transcribeCall:!0}},{id:"marketing-campaigns",name:"Marketing & Sales",priority:7,conditions:{keywords:["marketing","campaign","sales","customer","lead"]},actions:{assignToExecutive:"cmo",recordCall:!0,transcribeCall:!0}},{id:"hr-matters",name:"Human Resources",priority:6,conditions:{keywords:["hr","hiring","employee","culture","benefits"]},actions:{assignToExecutive:"chro",recordCall:!0,transcribeCall:!0}},{id:"legal-compliance",name:"Legal & Compliance",priority:8,conditions:{keywords:["legal","contract","compliance","risk","lawsuit"]},actions:{assignToExecutive:"clo",recordCall:!0,transcribeCall:!0,requireApproval:!0}},{id:"operations",name:"Operations & Processes",priority:7,conditions:{keywords:["operations","process","efficiency","logistics"]},actions:{assignToExecutive:"coo",recordCall:!0,transcribeCall:!0}},{id:"strategy-planning",name:"Strategic Planning",priority:8,conditions:{keywords:["strategy","planning","roadmap","competition","market"]},actions:{assignToExecutive:"cso",recordCall:!0,transcribeCall:!0}},{id:"vip-callers",name:"VIP Caller Routing",priority:10,conditions:{callerPattern:/\+1(555|800|888|877|866|855|844|833|822)/,urgency:"critical"},actions:{assignToExecutive:"ceo",recordCall:!0,transcribeCall:!0,notifyOthers:["cfo","coo"]}},{id:"after-hours",name:"After Hours Routing",priority:5,conditions:{timeRange:{start:"18:00",end:"08:00"}},actions:{assignToExecutive:"coo",recordCall:!0,transcribeCall:!0,requireApproval:!0}}]}initializeEventListeners(){this.eventListeners.set("executiveAssigned",[]),this.eventListeners.set("routingFailed",[]),this.eventListeners.set("loadBalanced",[]),this.eventListeners.set("availabilityChanged",[])}async assignExecutive(e,t){try{let i=await this.buildCallContext(e,t),s=this.findMatchingRules(i),o=this.getExecutiveFromRules(s);o||(o=this.loadBalanceExecutives(i));let n=this.executives.get(o);return n&&this.isExecutiveAvailable(n)||(o=this.findAlternativeExecutive(o,i)),this.updateExecutiveLoad(o,1),this.storeCallContext(e,i),console.log(`Call from ${e} assigned to ${o}`),this.emit("executiveAssigned",{callerUri:e,executive:o,context:i}),o}catch(t){return console.error("Failed to assign executive:",t),this.emit("routingFailed",{callerUri:e,error:t}),"ceo"}}async buildCallContext(e,t){let i=this.callHistory.get(e)?.length||0;return{callerId:e,callerName:t?.callerName,callerCompany:t?.callerCompany,previousInteractions:i,estimatedValue:t?.estimatedValue,urgency:t?.urgency||"medium",keywords:t?.keywords||[],timeOfCall:new Date}}findMatchingRules(e){return this.routingRules.filter(t=>this.ruleMatches(t,e)).sort((e,t)=>t.priority-e.priority)}ruleMatches(e,t){let i=e.conditions;if(i.callerPattern&&!i.callerPattern.test(t.callerId))return!1;if(i.timeRange){let e=new Date,t=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;if(t<i.timeRange.start||t>i.timeRange.end)return!1}return(!i.dayOfWeek||!!i.dayOfWeek.includes(t.timeOfCall.getDay()))&&(!i.keywords||!!i.keywords.some(e=>t.keywords.some(t=>t.toLowerCase().includes(e.toLowerCase()))))&&(!i.urgency||t.urgency===i.urgency)}getExecutiveFromRules(e){for(let t of e)if(t.actions.assignToExecutive){let e=this.executives.get(t.actions.assignToExecutive);if(e&&this.isExecutiveAvailable(e))return t.actions.assignToExecutive}return null}loadBalanceExecutives(e){let t=Array.from(this.executives.values()).filter(e=>this.isExecutiveAvailable(e)).sort((e,t)=>e.currentLoad!==t.currentLoad?e.currentLoad-t.currentLoad:t.priority-e.priority);return 0===t.length?"ceo":t[0].id}isExecutiveAvailable(e){return"available"===e.availability&&e.currentLoad<e.maxConcurrentCalls}findAlternativeExecutive(e,t){let i=this.executives.get(e);if(!i)return"ceo";let s=Array.from(this.executives.values()).filter(t=>t.id!==e&&this.isExecutiveAvailable(t)&&t.specializations.some(e=>i.specializations.includes(e))).sort((e,t)=>t.priority-e.priority);return s.length>0?s[0].id:"ceo"}updateExecutiveLoad(e,t){let i=this.executives.get(e);i&&(i.currentLoad=Math.max(0,i.currentLoad+t),this.emit("loadBalanced",{executiveId:e,newLoad:i.currentLoad}))}storeCallContext(e,t){this.callHistory.has(e)||this.callHistory.set(e,[]),this.callHistory.get(e).push(t);let i=this.callHistory.get(e);i.length>10&&i.splice(0,i.length-10)}releaseExecutive(e){this.updateExecutiveLoad(e,-1)}setExecutiveAvailability(e,t){let i=this.executives.get(e);i&&(i.availability=t,this.emit("availabilityChanged",{executiveId:e,availability:t}))}getExecutiveProfile(e){return this.executives.get(e)}getAllExecutives(){return Array.from(this.executives.values())}getAvailableExecutives(){return Array.from(this.executives.values()).filter(e=>this.isExecutiveAvailable(e))}addRoutingRule(e){this.routingRules.push(e),this.routingRules.sort((e,t)=>t.priority-e.priority)}removeRoutingRule(e){this.routingRules=this.routingRules.filter(t=>t.id!==e)}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let i=this.eventListeners.get(e);if(i){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}}class h{constructor(e,t,i){this.config=e,this.ua=null,this.activeSessions=new Map,this.eventListeners=new Map,this.audioProcessor=t||new l,this.voiceRouter=i||new c,this.initializeEventListeners()}initializeEventListeners(){this.eventListeners.set("registered",[]),this.eventListeners.set("unregistered",[]),this.eventListeners.set("registrationFailed",[]),this.eventListeners.set("invite",[]),this.eventListeners.set("connected",[]),this.eventListeners.set("disconnected",[]),this.eventListeners.set("failed",[]),this.eventListeners.set("bye",[])}async initialize(){try{let e=n.Z.makeURI(this.config.uri);if(!e)throw Error(`Failed to create valid URI from ${this.config.uri}`);this.ua=new n.Z({uri:e,transportOptions:this.config.transportOptions,authorizationUsername:this.config.authorizationUsername,authorizationPassword:this.config.authorizationPassword,displayName:this.config.displayName,delegate:{onInvite:this.handleIncomingCall.bind(this),onConnect:()=>this.emit("connected"),onDisconnect:()=>this.emit("disconnected")},allowLegacyNotifications:!0,contactName:this.config.displayName,contactParams:{},forceRport:!1,logLevel:"warn",noAnswerTimeout:60,sessionDescriptionHandlerFactoryOptions:{constraints:{audio:!0,video:!1},peerConnectionConfiguration:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}},userAgentString:"SOVREN AI Executive Command Center v1.0"}),this.ua.delegate={onInvite:this.handleIncomingCall.bind(this),onConnect:()=>this.emit("connected"),onDisconnect:()=>this.emit("disconnected")},await this.ua.start(),console.log("SIP Client initialized successfully"),this.emit("registered")}catch(e){throw console.error("Failed to initialize SIP Client:",e),this.emit("registrationFailed",e),e}}async makeCall(e,t){if(!this.ua)throw Error("SIP Client not initialized");try{let i=n.Z.makeURI(e);if(!i)throw Error(`Failed to create valid URI from ${e}`);let s=new a.M(this.ua,i,{sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}}}),o=this.generateSessionId(),l={id:o,executive:t,remoteUri:e,state:r.s.Initial,startTime:new Date,duration:0,isInbound:!1};return this.activeSessions.set(o,l),s.delegate={onBye:()=>this.handleCallEnd(o),onSessionDescriptionHandler:e=>{e&&e.peerConnection&&(l.audioStream=e.peerConnection?.getLocalStreams()?.[0],l.audioStream&&this.audioProcessor.processOutboundAudio(l.audioStream,t))}},await s.invite(),console.log(`Outbound call initiated: ${o} for executive ${t}`),this.emit("invite",l),o}catch(e){throw console.error("Failed to make call:",e),e}}async handleIncomingCall(e){let t=this.generateSessionId(),i=await this.voiceRouter.assignExecutive(e.remoteIdentity.uri.toString()),s={id:t,executive:i,remoteUri:e.remoteIdentity.uri.toString(),state:e.state,startTime:new Date,duration:0,isInbound:!0};this.activeSessions.set(t,s),e.delegate={onBye:()=>this.handleCallEnd(t),onSessionDescriptionHandler:e=>{e&&e.peerConnection&&(s.audioStream=e.peerConnection?.getRemoteStreams()?.[0],s.audioStream&&this.audioProcessor.processInboundAudio(s.audioStream,i))}},console.log(`Incoming call received: ${t} assigned to ${i}`),this.emit("invite",s);try{await e.accept(),s.state=r.s.Established,this.emit("connected",s)}catch(e){console.error("Failed to accept incoming call:",e),this.handleCallEnd(t)}}handleCallEnd(e){let t=this.activeSessions.get(e);t&&(t.duration=Date.now()-t.startTime.getTime(),console.log(`Call ended: ${e}, duration: ${t.duration}ms`),t.audioStream&&this.audioProcessor.stopProcessing(t.audioStream),this.activeSessions.delete(e),this.emit("bye",t))}async endCall(e){if(!this.activeSessions.get(e))throw Error(`Session not found: ${e}`);this.handleCallEnd(e)}getActiveSessions(){return Array.from(this.activeSessions.values())}getSessionById(e){return this.activeSessions.get(e)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let i=this.eventListeners.get(e);if(i){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}async disconnect(){if(this.ua){for(let e of this.activeSessions.keys())await this.endCall(e);await this.ua.stop(),this.ua=null,console.log("SIP Client disconnected"),this.emit("disconnected")}}}class d{constructor(e){this.models=new Map,this.wasmModule=null,this.isInitialized=!1,this.webGPUDevice=null,this.audioContext=null,this.eventListeners=new Map,this.config=e,this.initializeEventListeners()}initializeEventListeners(){this.eventListeners.set("engineReady",[]),this.eventListeners.set("modelLoaded",[]),this.eventListeners.set("synthesisProgress",[]),this.eventListeners.set("synthesisComplete",[]),this.eventListeners.set("error",[])}async initialize(){try{console.log("Initializing StyleTTS2 Neural Voice Engine..."),this.config.enableWebAssembly&&await this.initializeWebAssembly(),"webgpu"===this.config.device&&await this.initializeWebGPU(),this.audioContext=new AudioContext({sampleRate:22050,latencyHint:"interactive"}),await this.loadExecutiveModels(),this.isInitialized=!0,console.log("✓ StyleTTS2 Engine initialized successfully"),this.emit("engineReady")}catch(e){throw console.error("Failed to initialize StyleTTS2 Engine:",e),this.emit("error",e),e}}async initializeWebAssembly(){try{console.log("Loading StyleTTS2 WebAssembly module...");let e=await fetch("/wasm/styletts2.wasm");await e.arrayBuffer(),await new Promise(e=>setTimeout(e,1e3)),this.wasmModule={synthesize:this.wasmSynthesize.bind(this),loadModel:this.wasmLoadModel.bind(this),setParameters:this.wasmSetParameters.bind(this)},console.log("✓ WebAssembly module loaded")}catch(e){console.warn("WebAssembly not available, falling back to JavaScript implementation"),this.config.enableWebAssembly=!1}}async initializeWebGPU(){try{if(!navigator.gpu)throw Error("WebGPU not supported");let e=await navigator.gpu.requestAdapter();if(!e)throw Error("No WebGPU adapter found");this.webGPUDevice=await e.requestDevice(),console.log("✓ WebGPU device initialized")}catch(e){console.warn("WebGPU not available, falling back to CPU processing"),this.config.device="cpu"}}async loadExecutiveModels(){let e=[{id:"sovren-ai-neural",name:"SOVREN AI Neural Core Voice",modelPath:"/models/sovren-ai-neural.onnx",vocoderPath:"/models/hifigan-sovren.onnx",configPath:"/models/sovren-config.json"},{id:"ceo-authoritative",name:"CEO Executive Voice",modelPath:"/models/ceo-authoritative.onnx",vocoderPath:"/models/hifigan-ceo.onnx",configPath:"/models/ceo-config.json"},{id:"cfo-analytical",name:"CFO Analytical Voice",modelPath:"/models/cfo-analytical.onnx",vocoderPath:"/models/hifigan-cfo.onnx",configPath:"/models/cfo-config.json"},{id:"cto-technical",name:"CTO Technical Voice",modelPath:"/models/cto-technical.onnx",vocoderPath:"/models/hifigan-cto.onnx",configPath:"/models/cto-config.json"},{id:"cmo-persuasive",name:"CMO Persuasive Voice",modelPath:"/models/cmo-persuasive.onnx",vocoderPath:"/models/hifigan-cmo.onnx",configPath:"/models/cmo-config.json"},{id:"coo-operational",name:"COO Operational Voice",modelPath:"/models/coo-operational.onnx",vocoderPath:"/models/hifigan-coo.onnx",configPath:"/models/coo-config.json"},{id:"chro-empathetic",name:"CHRO Empathetic Voice",modelPath:"/models/chro-empathetic.onnx",vocoderPath:"/models/hifigan-chro.onnx",configPath:"/models/chro-config.json"},{id:"clo-precise",name:"CLO Precise Voice",modelPath:"/models/clo-precise.onnx",vocoderPath:"/models/hifigan-clo.onnx",configPath:"/models/clo-config.json"},{id:"cso-strategic",name:"CSO Strategic Voice",modelPath:"/models/cso-strategic.onnx",vocoderPath:"/models/hifigan-cso.onnx",configPath:"/models/cso-config.json"}].map(e=>this.loadModel(e));await Promise.all(e)}async loadModel(e){try{console.log(`Loading StyleTTS2 model: ${e.name}`);let[t,i,s]=await Promise.all([this.loadModelData(e.modelPath),this.loadModelData(e.vocoderPath),this.loadConfigData(e.configPath)]),o={id:e.id,name:e.name,modelData:t,vocoderData:i,configData:s,isLoaded:!0,loadTime:Date.now(),memoryUsage:t.byteLength+i.byteLength};this.models.set(e.id,o),console.log(`✓ Model loaded: ${e.name} (${(o.memoryUsage/1024/1024).toFixed(1)}MB)`),this.emit("modelLoaded",{modelId:e.id,model:o})}catch(t){console.error(`Failed to load model ${e.id}:`,t),this.emit("error",{modelId:e.id,error:t})}}async loadModelData(e){return await new Promise(e=>setTimeout(e,500)),new ArrayBuffer(52428800)}async loadConfigData(e){return await new Promise(e=>setTimeout(e,100)),{sample_rate:22050,hop_length:256,win_length:1024,n_mel:80,n_fft:1024,f_min:0,f_max:11025,max_wav_value:32768}}async synthesize(e){if(!this.isInitialized)throw Error("StyleTTS2 Engine not initialized");let t=this.models.get(e.voiceId);if(!t)throw Error(`Voice model not found: ${e.voiceId}`);try{console.log(`Synthesizing with StyleTTS2: "${e.text}" using ${t.name}`);let i=this.preprocessText(e.text);this.emit("synthesisProgress",{stage:"mel_generation",progress:.2});let s=await this.generateMelSpectrogram(i,t,e);this.emit("synthesisProgress",{stage:"vocoding",progress:.6});let o=await this.vocode(s,t,e);this.emit("synthesisProgress",{stage:"post_processing",progress:.9});let n=await this.postProcessAudio(o,e);return this.emit("synthesisProgress",{stage:"complete",progress:1}),this.emit("synthesisComplete",{voiceId:e.voiceId,audioBuffer:n}),n}catch(t){throw console.error("StyleTTS2 synthesis failed:",t),this.emit("error",{voiceId:e.voiceId,error:t}),t}}preprocessText(e){return e.toLowerCase().replace(/[^\w\s.,!?-]/g,"").replace(/\s+/g," ").trim()}async generateMelSpectrogram(e,t,i){return this.config.enableWebAssembly&&this.wasmModule?await this.wasmModule.synthesize(e,t,i):await this.jsSynthesize(e,t,i)}async jsSynthesize(e,t,i){let s=Math.floor(.1*e.length*22050/256);await new Promise(t=>setTimeout(t,10*e.length));let o=new Float32Array(80*s);for(let e=0;e<s;e++)for(let t=0;t<80;t++){let s=11025*t/80,n=256*e/22050,a=0;for(let e of[800,1200,2400])a+=Math.exp(-Math.abs(s-e)/200)*(1+Math.sin(2*n*Math.PI*150));a*=this.getVoiceCharacteristics(i.voiceId,s),o[80*e+t]=a}return o}getVoiceCharacteristics(e,t){let i={"ceo-authoritative":{low:1.2,mid:1,high:.8},"cfo-analytical":{low:.9,mid:1.1,high:1},"cto-technical":{low:1,mid:1,high:1.1},"cmo-persuasive":{low:1.1,mid:1.2,high:1},"coo-operational":{low:1,mid:1,high:.9},"chro-empathetic":{low:1.1,mid:1.1,high:.9},"clo-precise":{low:.8,mid:1,high:1},"cso-strategic":{low:1,mid:1.1,high:1}}[e]||{low:1,mid:1,high:1};return t<500?i.low:t<2e3?i.mid:i.high}async vocode(e,t,i){let s=e.length/80,o=256*s;await new Promise(e=>setTimeout(e,2*s));let n=new ArrayBuffer(2*o),a=new Int16Array(n);for(let t=0;t<o;t++){let s=80*Math.floor(t/256),o=0;for(let i=0;i<80;i++)o+=(e[s+i]||0)*Math.sin(t/22050*2*Math.PI*(11025*i/80))*.01;o*=i.prosody.volume,o=Math.tanh(o),a[t]=Math.max(-32768,Math.min(32767,16384*o))}return n}async postProcessAudio(e,t){let i=new Int16Array(e),s=0;for(let e=0;e<i.length;e++)s=Math.max(s,Math.abs(i[e]));if(s>0){let e=16384/s;for(let t=0;t<i.length;t++)i[t]*=e}return e}async wasmSynthesize(e,t,i){return this.jsSynthesize(e,t,i)}wasmLoadModel(e){return!0}wasmSetParameters(e){}getLoadedModels(){return Array.from(this.models.values())}getModelById(e){return this.models.get(e)}getMemoryUsage(){return Array.from(this.models.values()).reduce((e,t)=>e+t.memoryUsage,0)}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let i=this.eventListeners.get(e);if(i){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}async shutdown(){console.log("Shutting down StyleTTS2 Engine..."),this.models.clear(),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.webGPUDevice&&(this.webGPUDevice.destroy(),this.webGPUDevice=null),this.isInitialized=!1,console.log("✓ StyleTTS2 Engine shutdown complete")}}class u{constructor(e){this.config=e,this.voiceModels=new Map,this.synthesisQueue=[],this.isProcessing=!1,this.audioContext=null,this.cache=new Map,this.eventListeners=new Map,this.workerPool=[],this.maxWorkers=4,this.styleTTS2Engine=null,this.initializeEventListeners(),this.initializeVoiceModels()}initializeEventListeners(){this.eventListeners.set("ready",[]),this.eventListeners.set("synthesisComplete",[]),this.eventListeners.set("synthesisError",[]),this.eventListeners.set("modelLoaded",[]),this.eventListeners.set("queueUpdated",[]),this.eventListeners.set("error",[])}initializeVoiceModels(){[{id:"sovren-ai-neural",name:"SOVREN AI Neural Core Voice",language:"en-US",gender:"neutral",characteristics:{pitch:1,speed:1.1,tone:"authoritative",accent:"neural-synthetic"},modelPath:`${this.config.modelsPath}/sovren-ai-neural.onnx`,isLoaded:!1},{id:"ceo-authoritative",name:"CEO Executive Voice",language:"en-US",gender:"male",characteristics:{pitch:.8,speed:.9,tone:"authoritative",accent:"american-executive"},modelPath:`${this.config.modelsPath}/ceo-authoritative.onnx`,isLoaded:!1},{id:"cfo-analytical",name:"CFO Analytical Voice",language:"en-US",gender:"female",characteristics:{pitch:1.1,speed:.95,tone:"analytical",accent:"american-professional"},modelPath:`${this.config.modelsPath}/cfo-analytical.onnx`,isLoaded:!1},{id:"cto-technical",name:"CTO Technical Voice",language:"en-US",gender:"male",characteristics:{pitch:.9,speed:1,tone:"technical",accent:"american-tech"},modelPath:`${this.config.modelsPath}/cto-technical.onnx`,isLoaded:!1},{id:"cmo-persuasive",name:"CMO Persuasive Voice",language:"en-US",gender:"female",characteristics:{pitch:1.2,speed:1.05,tone:"persuasive",accent:"american-marketing"},modelPath:`${this.config.modelsPath}/cmo-persuasive.onnx`,isLoaded:!1},{id:"coo-operational",name:"COO Operational Voice",language:"en-US",gender:"male",characteristics:{pitch:.85,speed:.98,tone:"operational",accent:"american-business"},modelPath:`${this.config.modelsPath}/coo-operational.onnx`,isLoaded:!1},{id:"chro-empathetic",name:"CHRO Empathetic Voice",language:"en-US",gender:"female",characteristics:{pitch:1.15,speed:.92,tone:"empathetic",accent:"american-caring"},modelPath:`${this.config.modelsPath}/chro-empathetic.onnx`,isLoaded:!1},{id:"clo-precise",name:"CLO Precise Voice",language:"en-US",gender:"male",characteristics:{pitch:.88,speed:.88,tone:"precise",accent:"american-legal"},modelPath:`${this.config.modelsPath}/clo-precise.onnx`,isLoaded:!1},{id:"cso-strategic",name:"CSO Strategic Voice",language:"en-US",gender:"female",characteristics:{pitch:1.05,speed:.93,tone:"strategic",accent:"american-strategic"},modelPath:`${this.config.modelsPath}/cso-strategic.onnx`,isLoaded:!1}].forEach(e=>{this.voiceModels.set(e.id,e)})}async initialize(){if(!this.config.enabled){console.log("Voice synthesis is disabled");return}try{this.audioContext=new AudioContext({sampleRate:22050,latencyHint:"interactive"});let e={modelPath:this.config.modelsPath,vocoder:"hifigan",device:"cpu",batchSize:1,maxLength:1e3,temperature:.7,lengthScale:1,noiseScale:.667,enableWebAssembly:!0};this.styleTTS2Engine=new d(e),this.styleTTS2Engine.on("engineReady",()=>{console.log("✓ StyleTTS2 Engine ready")}),this.styleTTS2Engine.on("modelLoaded",e=>{console.log(`✓ StyleTTS2 model loaded: ${e.modelId}`),this.emit("modelLoaded",e)}),this.styleTTS2Engine.on("synthesisProgress",e=>{this.emit("synthesisProgress",e)}),this.styleTTS2Engine.on("error",e=>{console.error("StyleTTS2 Engine error:",e),this.emit("error",e)}),await this.styleTTS2Engine.initialize(),await this.initializeWorkerPool(),await Promise.all(["sovren-ai-neural","ceo-authoritative","cfo-analytical","cto-technical"].map(e=>this.loadVoiceModel(e))),console.log("Voice Synthesizer with StyleTTS2 initialized successfully"),this.emit("ready")}catch(e){throw console.error("Failed to initialize Voice Synthesizer:",e),this.emit("error",e),e}}async initializeWorkerPool(){for(let e=0;e<this.maxWorkers;e++)try{let e=new Worker("/workers/voice-synthesis-worker.js");e.onmessage=this.handleWorkerMessage.bind(this),e.onerror=this.handleWorkerError.bind(this),this.workerPool.push(e)}catch(t){console.warn(`Failed to create synthesis worker ${e}:`,t)}0===this.workerPool.length&&console.warn("No synthesis workers available, falling back to main thread processing")}handleWorkerMessage(e){let{type:t,requestId:i,result:s,error:o}=e.data;switch(t){case"synthesis-complete":this.handleSynthesisComplete(i,s);break;case"synthesis-error":this.handleSynthesisError(i,o);break;case"model-loaded":this.handleModelLoaded(s.modelId)}}handleWorkerError(e){console.error("Synthesis worker error:",e),this.emit("error",e)}async loadVoiceModel(e){let t=this.voiceModels.get(e);if(t&&!t.isLoaded)try{console.log(`Loading voice model: ${t.name}`),await new Promise(e=>setTimeout(e,1e3)),t.isLoaded=!0,console.log(`✓ Voice model loaded: ${t.name}`),this.emit("modelLoaded",{modelId:e,model:t})}catch(t){throw console.error(`Failed to load voice model ${e}:`,t),this.emit("error",{modelId:e,error:t}),t}}async synthesize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal",s=arguments.length>3?arguments[3]:void 0;if(!this.config.enabled)throw Error("Voice synthesis is disabled");let o=this.voiceModels.get(t);if(!o)throw Error(`Voice model not found: ${t}`);o.isLoaded||await this.loadVoiceModel(t);let n={id:this.generateRequestId(),text:e,voiceModel:t,priority:i,timestamp:new Date,options:s},a=this.generateCacheKey(n);if(this.cache.has(a)){let e=this.cache.get(a);return this.emit("synthesisComplete",{requestId:n.id,result:e,fromCache:!0}),n.id}return this.addToQueue(n),this.isProcessing||this.processQueue(),n.id}addToQueue(e){let t={high:0,normal:1,low:2},i=this.synthesisQueue.findIndex(i=>t[i.priority]>t[e.priority]);-1===i?this.synthesisQueue.push(e):this.synthesisQueue.splice(i,0,e),this.emit("queueUpdated",{queueLength:this.synthesisQueue.length})}async processQueue(){if(!this.isProcessing&&0!==this.synthesisQueue.length){for(this.isProcessing=!0;this.synthesisQueue.length>0;){let e=this.synthesisQueue.shift();try{await this.processSynthesisRequest(e)}catch(t){console.error(`Synthesis failed for request ${e.id}:`,t),this.emit("synthesisError",{requestId:e.id,error:t})}}this.isProcessing=!1}}async processSynthesisRequest(e){let t=this.voiceModels.get(e.voiceModel),i=this.getAvailableWorker();i?i.postMessage({type:"synthesize",request:e,model:t}):await this.synthesizeInMainThread(e,t)}getAvailableWorker(){return this.workerPool.length>0?this.workerPool[0]:null}async synthesizeInMainThread(e,t){try{if(console.log(`Synthesizing with StyleTTS2: "${e.text}" using ${t.name}`),this.styleTTS2Engine){let i={text:e.text,voiceId:e.voiceModel,speed:e.options?.speed||t.characteristics.speed,pitch:e.options?.pitch||t.characteristics.pitch,energy:1,emotion:e.options?.emotion||"neutral",style:[],prosody:{rate:e.options?.speed||1,volume:e.options?.volume||1,emphasis:[]}},s=await this.styleTTS2Engine.synthesize(i),o=s.byteLength/2/22050*1e3,n={requestId:e.id,audioBuffer:s,duration:o,format:"wav",sampleRate:22050};this.handleSynthesisComplete(e.id,n)}else{console.log(`Fallback synthesis: "${e.text}" with ${t.name}`);let i=50*e.text.length;await new Promise(e=>setTimeout(e,i));let s=Math.floor(22050*i/1e3),o=new ArrayBuffer(2*s),n={requestId:e.id,audioBuffer:o,duration:i,format:"wav",sampleRate:22050};this.handleSynthesisComplete(e.id,n)}}catch(t){console.error("Synthesis failed, falling back to basic synthesis:",t),this.handleSynthesisError(e.id,t)}}handleSynthesisComplete(e,t){let i=this.synthesisQueue.find(t=>t.id===e);if(i){let e=this.generateCacheKey(i);this.addToCache(e,t)}console.log(`Synthesis complete for request: ${e}`),this.emit("synthesisComplete",{requestId:e,result:t})}handleSynthesisError(e,t){console.error(`Synthesis error for request ${e}:`,t),this.emit("synthesisError",{requestId:e,error:t})}handleModelLoaded(e){let t=this.voiceModels.get(e);t&&(t.isLoaded=!0,this.emit("modelLoaded",{modelId:e,model:t}))}generateRequestId(){return`synthesis_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateCacheKey(e){let t=JSON.stringify(e.options||{});return`${e.voiceModel}_${e.text}_${t}`}addToCache(e,t){if(this.cache.size>=this.config.cacheSize){let e=this.cache.keys().next().value;void 0!==e&&this.cache.delete(e)}this.cache.set(e,t)}getVoiceModels(){return Array.from(this.voiceModels.values())}getLoadedModels(){return Array.from(this.voiceModels.values()).filter(e=>e.isLoaded)}getQueueLength(){return this.synthesisQueue.length}clearQueue(){this.synthesisQueue=[],this.emit("queueUpdated",{queueLength:0})}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let i=this.eventListeners.get(e);if(i){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}getStyleTTS2Status(){return this.styleTTS2Engine?{status:"ready",loadedModels:this.styleTTS2Engine.getLoadedModels().length,memoryUsage:this.styleTTS2Engine.getMemoryUsage()}:{status:"not_initialized"}}async shutdown(){console.log("Shutting down Voice Synthesizer..."),this.clearQueue(),this.workerPool.forEach(e=>e.terminate()),this.workerPool=[],this.styleTTS2Engine&&(await this.styleTTS2Engine.shutdown(),this.styleTTS2Engine=null),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.cache.clear(),console.log("✓ Voice Synthesizer shutdown complete")}}class m{constructor(e){this.config=e,this.isInitialized=!1,this.eventListeners=new Map,this.audioProcessor=new l(e.audio),this.voiceRouter=new c,this.voiceSynthesizer=new u(e.synthesis),this.sipClient=new h(e.sip,this.audioProcessor,this.voiceRouter),this.systemStatus={isInitialized:!1,sipStatus:"disconnected",audioStatus:"inactive",synthesisStatus:e.synthesis.enabled?"loading":"disabled",activeCalls:0,availableExecutives:8,systemLoad:0},this.initializeEventListeners(),this.setupComponentEventHandlers()}initializeEventListeners(){this.eventListeners.set("systemReady",[]),this.eventListeners.set("callStarted",[]),this.eventListeners.set("callEnded",[]),this.eventListeners.set("executiveAssigned",[]),this.eventListeners.set("audioActivity",[]),this.eventListeners.set("synthesisComplete",[]),this.eventListeners.set("error",[]),this.eventListeners.set("statusChanged",[])}setupComponentEventHandlers(){this.sipClient.on("registered",()=>{this.systemStatus.sipStatus="connected",this.emit("statusChanged",this.systemStatus)}),this.sipClient.on("registrationFailed",e=>{this.systemStatus.sipStatus="error",this.emit("error",{component:"sip",error:e}),this.emit("statusChanged",this.systemStatus)}),this.sipClient.on("invite",e=>{this.systemStatus.activeCalls++,this.emit("callStarted",e),this.emit("statusChanged",this.systemStatus)}),this.sipClient.on("bye",e=>{this.systemStatus.activeCalls--,this.voiceRouter.releaseExecutive(e.executive),this.emit("callEnded",e),this.emit("statusChanged",this.systemStatus)}),this.audioProcessor.on("audioActivity",e=>{this.emit("audioActivity",e)}),this.voiceRouter.on("executiveAssigned",e=>{this.emit("executiveAssigned",e)}),this.voiceRouter.on("availabilityChanged",()=>{this.systemStatus.availableExecutives=this.voiceRouter.getAvailableExecutives().length,this.emit("statusChanged",this.systemStatus)}),this.voiceSynthesizer.on("ready",()=>{this.systemStatus.synthesisStatus="ready",this.emit("statusChanged",this.systemStatus)}),this.voiceSynthesizer.on("error",e=>{this.systemStatus.synthesisStatus="error",this.emit("error",{component:"synthesis",error:e}),this.emit("statusChanged",this.systemStatus)}),this.voiceSynthesizer.on("synthesisComplete",e=>{this.emit("synthesisComplete",e)})}async initialize(){try{console.log("Initializing SOVREN AI Voice System..."),this.systemStatus.audioStatus="active",await this.audioProcessor.initialize(),console.log("✓ Audio Processor initialized"),this.config.synthesis.enabled&&(await this.voiceSynthesizer.initialize(),console.log("✓ Voice Synthesizer initialized")),this.systemStatus.sipStatus="connecting",await this.sipClient.initialize(),console.log("✓ SIP Client initialized"),this.isInitialized=!0,this.systemStatus.isInitialized=!0,this.systemStatus.availableExecutives=this.voiceRouter.getAvailableExecutives().length,console.log("\uD83C\uDF89 SOVREN AI Voice System initialized successfully"),this.emit("systemReady",this.systemStatus),this.emit("statusChanged",this.systemStatus)}catch(e){throw console.error("Failed to initialize Voice System:",e),this.emit("error",{component:"system",error:e}),e}}async makeCall(e,t,i){if(!this.isInitialized)throw Error("Voice System not initialized");try{if(!this.voiceRouter.getExecutiveProfile(t))throw Error(`Executive not found: ${t}`);let s=await this.sipClient.makeCall(e,t);return i&&this.config.synthesis.enabled&&await this.speakAsExecutive(t,i),s}catch(e){throw console.error("Failed to make call:",e),this.emit("error",{component:"calling",error:e}),e}}async endCall(e){if(!this.isInitialized)throw Error("Voice System not initialized");try{await this.sipClient.endCall(e)}catch(e){throw console.error("Failed to end call:",e),this.emit("error",{component:"calling",error:e}),e}}async speakAsExecutive(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";if(!this.config.synthesis.enabled){console.warn("Voice synthesis is disabled");return}try{let s=this.voiceRouter.getExecutiveProfile(e);if(!s)throw Error(`Executive not found: ${e}`);await this.voiceSynthesizer.synthesize(t,s.voiceModel,i)}catch(e){throw console.error("Failed to synthesize speech:",e),this.emit("error",{component:"synthesis",error:e}),e}}getActiveCalls(){return this.sipClient.getActiveSessions()}getCallById(e){return this.sipClient.getSessionById(e)}getExecutiveProfiles(){return this.voiceRouter.getAllExecutives()}getAvailableExecutives(){return this.voiceRouter.getAvailableExecutives()}setExecutiveAvailability(e,t){this.voiceRouter.setExecutiveAvailability(e,t)}updateExecutivePosition(e,t,i,s){this.audioProcessor.updateExecutivePosition(e,t,i,s)}getSystemStatus(){let e=this.sipClient.getActiveSessions().length,t=this.voiceRouter.getAllExecutives().reduce((e,t)=>e+t.maxConcurrentCalls,0);return this.systemStatus.systemLoad=t>0?e/t*100:0,this.systemStatus.activeCalls=e,{...this.systemStatus}}async startRecording(e){if(!this.config.recording.enabled){console.warn("Call recording is disabled");return}console.log(`Starting recording for session: ${e}`)}async stopRecording(e){if(!this.config.recording.enabled)throw Error("Call recording is disabled");return console.log(`Stopping recording for session: ${e}`),`/recordings/${e}.${this.config.recording.format}`}async startTranscription(e){if(!this.config.transcription.enabled){console.warn("Call transcription is disabled");return}console.log(`Starting transcription for session: ${e}`)}async getTranscript(e){if(!this.config.transcription.enabled)throw Error("Call transcription is disabled");return console.log(`Getting transcript for session: ${e}`),`Transcript for session ${e}`}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){let i=this.eventListeners.get(e);if(i){let e=i.indexOf(t);e>-1&&i.splice(e,1)}}emit(e,t){let i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}async shutdown(){console.log("Shutting down SOVREN AI Voice System...");try{await this.sipClient.disconnect(),await this.audioProcessor.destroy(),this.config.synthesis.enabled&&await this.voiceSynthesizer.shutdown(),this.isInitialized=!1,this.systemStatus.isInitialized=!1,this.systemStatus.sipStatus="disconnected",this.systemStatus.audioStatus="inactive",console.log("✓ Voice System shutdown complete"),this.emit("statusChanged",this.systemStatus)}catch(e){throw console.error("Error during Voice System shutdown:",e),this.emit("error",{component:"shutdown",error:e}),e}}}let g={sip:{uri:"sip:sovren@localhost",transportOptions:{server:"wss://localhost:8089/ws",connectionTimeout:3e4,maxReconnectionAttempts:5,reconnectionTimeout:1e4},authorizationUsername:"sovren",authorizationPassword:"neural-war-terminal",displayName:"SOVREN AI Executive Command Center"},audio:{sampleRate:48e3,bufferSize:4096,enableNoiseReduction:!0,enableEchoCancellation:!0,enableAutoGainControl:!0,spatialAudioEnabled:!0},synthesis:{enabled:!0,modelsPath:"/voice-models",cacheSize:100},recording:{enabled:!0,format:"wav",quality:"high"},transcription:{enabled:!0,language:"en-US",realTime:!0}},v=(0,o.createContext)(null);function y(){let e=(0,o.useContext)(v);if(!e)throw Error("useVoiceSystemContext must be used within VoiceSystemProvider");return e}function p(e){let{children:t}=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoInitialize:t=!1,config:i={}}=e,s={...g,...i},[n,a]=(0,o.useState)(!1),[r,l]=(0,o.useState)({isInitialized:!1,sipStatus:"disconnected",audioStatus:"inactive",synthesisStatus:"disabled",activeCalls:0,availableExecutives:8,systemLoad:0}),[c,h]=(0,o.useState)(null),[d,u]=(0,o.useState)([]),[v,y]=(0,o.useState)([]),[p,f]=(0,o.useState)([]),C=(0,o.useRef)(null),w=(0,o.useRef)(new Map),S=(0,o.useCallback)(async()=>{if(!C.current&&!n)try{h(null);let e=new m(s);C.current=e,e.on("systemReady",t=>{a(!0),l(t),y(e.getExecutiveProfiles()),f(e.getAvailableExecutives())}),e.on("statusChanged",t=>{l(t),u(e.getActiveCalls()),f(e.getAvailableExecutives())}),e.on("callStarted",t=>{u(e.getActiveCalls()),(w.current.get("callStarted")||[]).forEach(e=>e(t))}),e.on("callEnded",t=>{u(e.getActiveCalls()),(w.current.get("callEnded")||[]).forEach(e=>e(t))}),e.on("executiveAssigned",t=>{f(e.getAvailableExecutives()),(w.current.get("executiveAssigned")||[]).forEach(e=>e(t))}),e.on("audioActivity",e=>{(w.current.get("audioActivity")||[]).forEach(t=>t(e))}),e.on("error",e=>{console.error("Voice System Error:",e),h(`${e.component}: ${e.error.message||e.error}`)}),await e.initialize()}catch(e){h(e instanceof Error?e.message:"Unknown error"),console.error("Failed to initialize voice system:",e)}},[s,n]),x=(0,o.useCallback)(async()=>{if(C.current)try{await C.current.shutdown(),C.current=null,a(!1),u([]),h(null)}catch(e){h(e instanceof Error?e.message:"Unknown error"),console.error("Failed to shutdown voice system:",e)}},[]),E=(0,o.useCallback)(async(e,t,i)=>{if(!C.current)throw Error("Voice system not initialized");return await C.current.makeCall(e,t,i)},[]),b=(0,o.useCallback)(async e=>{if(!C.current)throw Error("Voice system not initialized");await C.current.endCall(e)},[]),L=(0,o.useCallback)((e,t)=>{C.current&&C.current.setExecutiveAvailability(e,t)},[]),P=(0,o.useCallback)((e,t,i,s)=>{C.current&&C.current.updateExecutivePosition(e,t,i,s)},[]),z=(0,o.useCallback)(async function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";if(!C.current)throw Error("Voice system not initialized");await C.current.speakAsExecutive(e,t,i)},[]),A=(0,o.useCallback)(e=>{w.current.has("callStarted")||w.current.set("callStarted",[]),w.current.get("callStarted").push(e)},[]),M=(0,o.useCallback)(e=>{w.current.has("callEnded")||w.current.set("callEnded",[]),w.current.get("callEnded").push(e)},[]),T=(0,o.useCallback)(e=>{w.current.has("executiveAssigned")||w.current.set("executiveAssigned",[]),w.current.get("executiveAssigned").push(e)},[]),R=(0,o.useCallback)(e=>{w.current.has("audioActivity")||w.current.set("audioActivity",[]),w.current.get("audioActivity").push(e)},[]);return(0,o.useEffect)(()=>{!t||n||C.current||S()},[t,n,S]),(0,o.useEffect)(()=>()=>{C.current&&C.current.shutdown().catch(console.error)},[]),{isInitialized:n,status:r,error:c,activeCalls:d,makeCall:E,endCall:b,executives:v,availableExecutives:p,setExecutiveAvailability:L,updateExecutivePosition:P,speakAsExecutive:z,initialize:S,shutdown:x,onCallStarted:A,onCallEnded:M,onExecutiveAssigned:T,onAudioActivity:R}}({autoInitialize:!0,config:{synthesis:{enabled:!0,modelsPath:"/voice-models",cacheSize:50}}});return(0,s.jsx)(v.Provider,{value:i,children:t})}function f(e){let{children:t}=e;return(0,s.jsx)(p,{children:t})}}}]);